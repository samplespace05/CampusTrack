<%- include('partials/header') %>

<div class="form-container">
    <h1>Post a New Item</h1>
    <% if (typeof errors !== 'undefined' && errors.length > 0) { %>
        <div class="error-messages">
            <ul>
                <% errors.forEach(error => { %>
                    <li><%= error.msg %></li>
                <% }); %>
            </ul>
        </div>
    <% } %>
    <form method="POST" action="/items/new" enctype="multipart/form-data">
        <div class="form-group">
            <label for="name">Item Name:</label>
            <input type="text" id="name" name="name" required>
        </div>
        <div class="form-group">
            <label for="description">Description:</label>
            <textarea id="description" name="description" rows="4"></textarea>
        </div>
        <div class="form-group">
            <label for="category">Category:</label>
            <select id="category" name="category" required>
                <option value="lost">I Lost Something</option>
                <option value="found">I Found Something</option>
            </select>
        </div>
        <div class="form-group">
            <label for="location">Location (where it was lost/found):</label>
            <input type="text" id="location" name="location">
        </div>
        <div class="form-group">
            <label for="itemImage">Upload Image (Optional):</label>
            <input type="file" id="itemImage" name="itemImage" accept="image/*">
        </div>

        <div id="found-item-details" style="display: none;">
            <hr>
            <h3>Found Item Details</h3>
            <div class="form-group">
                <label for="custody_status">Where is the item now?</label>
                <select id="custody_status" name="custody_status">
                    <option value="with_finder">I have it with me</option>
                    <option value="with_guard">I submitted it to a security guard</option>
                </select>
            </div>
            <div id="guard-details" style="display: none;">
                <div class="form-group">
                    <label for="guard_name">Guard's Name:</label>
                    <input type="text" id="guard_name" name="guard_name">
                </div>
                <div class="form-group">
                    <label for="guard_phone">Guard's Phone (Optional):</label>
                    <input type="tel" id="guard_phone" name="guard_phone">
                </div>
            </div>
        </div>

        <button type="submit" class="btn">Submit Item</button>
    </form>
</div>

<script>
    const categorySelect = document.getElementById('category');
    const foundItemDetails = document.getElementById('found-item-details');
    const custodyStatusSelect = document.getElementById('custody_status');
    const guardDetails = document.getElementById('guard-details');
    const guardNameInput = document.getElementById('guard_name');

    function toggleFoundFields() {
        const isFound = categorySelect.value === 'found';
        foundItemDetails.style.display = isFound ? 'block' : 'none';
        if (isFound) {
            toggleGuardFields();
        } else {
            guardDetails.style.display = 'none';
            guardNameInput.required = false;
        }
    }

    function toggleGuardFields() {
        const isWithGuard = custodyStatusSelect.value === 'with_guard';
        guardDetails.style.display = isWithGuard ? 'block' : 'none';
        guardNameInput.required = isWithGuard;
    }

    categorySelect.addEventListener('change', toggleFoundFields);
    custodyStatusSelect.addEventListener('change', toggleGuardFields);

    // Initial check on page load
    toggleFoundFields();
</script>

<%- include('partials/footer') %>